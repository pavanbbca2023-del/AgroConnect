{% extends 'base.html' %}

{% block title %}Browse Waste Products - AgroConnect{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2>Available Waste Products</h2>
        <p class="text-muted">Browse agricultural waste products available for purchase</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <form method="get" class="d-flex">
            <select name="crop_type" class="form-select me-2">
                <option value="">All Crop Types</option>
                <option value="rice" {% if request.GET.crop_type == 'rice' %}selected{% endif %}>Rice Residue</option>
                <option value="corn" {% if request.GET.crop_type == 'corn' %}selected{% endif %}>Corn Residue</option>
                <option value="wheat" {% if request.GET.crop_type == 'wheat' %}selected{% endif %}>Wheat Residue</option>
                <option value="sugarcane" {% if request.GET.crop_type == 'sugarcane' %}selected{% endif %}>Sugarcane Residue</option>
                <option value="cotton" {% if request.GET.crop_type == 'cotton' %}selected{% endif %}>Cotton Residue</option>
                <option value="other" {% if request.GET.crop_type == 'other' %}selected{% endif %}>Other</option>
            </select>
            <button type="submit" class="btn btn-outline-primary">Filter</button>
        </form>
    </div>
</div>

<div class="row">
    {% if waste_products %}
        {% for product in waste_products %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h6 class="mb-0">{{ product.get_crop_name_display }}</h6>
                    <small class="text-muted">by {{ product.farmer.user_profile.user.get_full_name|default:product.farmer.user_profile.user.username }}</small>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ product.description|truncatewords:20 }}</p>
                    <div class="row">
                        <div class="col-6">
                            <strong>Quantity:</strong><br>
                            <span class="text-success">{{ product.quantity }} tons</span>
                        </div>
                        <div class="col-6">
                            <strong>Price:</strong><br>
                            <span class="text-primary">₹{{ product.price_per_ton }}/ton</span>
                        </div>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between align-items-center">
                        <strong>Total Value: ₹{{ product.total_value }}</strong>
                        <span class="badge bg-success">{{ product.get_status_display }}</span>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="d-grid gap-2">
                        <a href="{% url 'waste_detail' product.pk %}" class="btn btn-outline-primary btn-sm">View Details</a>
                        {% if user.is_authenticated and user.userprofile.role == 'company' %}
                            <a href="{% url 'place_order' product.id %}" class="btn btn-success btn-sm">Place Order</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="col-12">
            <div class="alert alert-info text-center">
                <h5>No waste products available</h5>
                <p>There are currently no waste products matching your criteria. Please check back later or try different filters.</p>
            </div>
        </div>
    {% endif %}
</div>

{% if waste_products %}
<div class="row mt-4">
    <div class="col-12 text-center">
        <p class="text-muted">Showing {{ waste_products|length }} product{{ waste_products|length|pluralize }}</p>
    </div>
</div>
{% endif %}
{% endblock %}